<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>å°èƒ–çš„åšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="éšå¿ƒç¬”è®°">
<meta property="og:type" content="website">
<meta property="og:title" content="å°èƒ–çš„åšå®¢">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="å°èƒ–çš„åšå®¢">
<meta property="og:description" content="éšå¿ƒç¬”è®°">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="PP">
<meta property="article:tag" content="éšå¿ƒç¬”è®°">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="å°èƒ–çš„åšå®¢" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">å°èƒ–çš„åšå®¢</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">è®°å½•å¤‡æˆ˜ç§‹æ‹›çš„ç‚¹ç‚¹æ»´æ»´</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/">ä¸»é¡µ</a>
        
          <a class="main-nav-link" href="/archives">ä¸“æ </a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS è®¢é˜…"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-mqå°è®°" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/12/mq%E5%B0%8F%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2021-05-12T10:17:58.000Z" itemprop="datePublished">2021-05-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">æ¶ˆæ¯é˜Ÿåˆ—</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/12/mq%E5%B0%8F%E8%AE%B0/">mqå°è®°</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="æ¶ˆæ¯ä¼ é€å¯é æ€§"><a href="#æ¶ˆæ¯ä¼ é€å¯é æ€§" class="headerlink" title="æ¶ˆæ¯ä¼ é€å¯é æ€§"></a>æ¶ˆæ¯ä¼ é€å¯é æ€§</h2><p>1ã€æ•°æ®åº“è¡¨ï¼šè®°å½•å‘é€æ¶ˆæ¯ï¼ˆå‘é€å¤±è´¥æ—¶çš„é‡è¯•ä¾æ®ï¼‰</p>
<p>2ã€å®ä½“ç±»ã€Œ</p>
<p>msgidï¼›//æ¶ˆæ¯id</p>
<p>Empid;//å‘˜å·¥idï¼Œå¯ä»¥æ˜¯å¤šä¸ª</p>
<p>statusï¼›//çŠ¶æ€ï¼šæˆåŠŸã€å¤±è´¥ã€æŠ•é€’ä¸­</p>
<p><strong>exchangeï¼›</strong></p>
<p><strong>routekeyï¼›//ä¸Šè¿°ä¸¤ä¸ªä¸ºmqè¦æ±‚å­—æ®µ</strong></p>
<p>countï¼›//é‡è¯•æ¬¡æ•°</p>
<p>trytimeï¼›//é‡è¯•æ—¶é—´</p>
<p>createtimeï¼›//åˆ›å»ºæ—¶é—´</p>
<p>updatetimeï¼›//æ›´æ–°æ—¶é—´</p>
<p>ã€</p>
<p>3ã€åœºæ™¯ï¼šæ·»åŠ å‘˜å·¥æˆåŠŸåï¼Œå‘è¯¥å‘˜å·¥å‘é€ä¸€æ¡æ¶ˆæ¯</p>
<p>if(result==1){</p>
<p>â€¦</p>
<p>æ•°æ®åº“æ’å…¥ä¸€æ¡æ¶ˆæ¯ï¼ˆidä¸ºuuidã€é‡è¯•æ—¶é—´ï¼ˆtrytimeï¼‰è®¾ç½®ä¸ºä¸€åˆ†é’Ÿåï¼‰//åé¢ä¼šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè¿›è¡Œé‡è¯•</p>
<p>â€¦</p>
<p>//Rabbitmqtemplate.convertAndSend(â€œwelcomeâ€,emp);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mailSendLogService.insert(mailSendLog);</span><br><span class="line">rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME, MailConstants.MAIL_ROUTING_KEY_NAME, emp, new CorrelationData(msgId));</span><br></pre></td></tr></table></figure>

<p>//CorrelationData(msgId)ä¼ å…¥å”¯ä¸€æ ‡è®°ç¬¦</p>
<p>}</p>
<p>4ã€é‡æ–°å®šä¹‰rabbitconfig</p>
<p>@Bean</p>
<p>rabbittemplate rabbittemplateï¼ˆï¼‰{</p>
<p>â€‹      new RabbitTEmplate(cachingConnectionFaction);//è¿æ¥ä¸Šrabbitmq,æ¶ˆæ¯å·²ç»å¯ä»¥å‘äº†</p>
<p>â€‹     //éœ€è¦ç¡®è®¤æ¶ˆæ¯æœ‰æ²¡æœ‰å‘é€æˆåŠŸ</p>
<p>â€‹     <strong>Rabbittemplate.setConfirmCallBack((data,ack,cause )-&gt;{.   //dataï¼šä¿å­˜äº†æ¶ˆæ¯çš„å”¯ä¸€idã€‚ac k:æ¶ˆæ¯æ˜¯å¦å‘é€æˆã€‚</strong></p>
<p>â€‹           If(ack){. //å‘é€æˆåŠŸ</p>
<p>â€‹           Data.getid();//æ¶ˆæ¯å”¯ä¸€id</p>
<p>â€‹           sou tï¼ˆâ€œæ¶ˆæ¯å‘é€æˆåŠŸâ€ï¼‰;</p>
<p>â€‹           mailservice.æ›´æ”¹æ•°æ®åº“æ¶ˆæ¯çŠ¶æ€ï¼ˆmsgid,statusï¼‰ï¼›</p>
<p>â€‹      }esle{     //å¤±è´¥</p>
<p>â€‹       â€¦â€¦</p>
<p>}</p>
<p>â€‹           <strong>//å¤±è´¥åŸå› :å¯èƒ½æ˜¯exchangeåˆ°queueå‘é€å¤±è´¥ä¼šæœ‰å›è°ƒ</strong></p>
<p>â€‹           <strong>rabbittemplate.setReturnCallback((msg,repcode,reptext,exchange,routingKey)-&gt;{</strong></p>
<p>â€‹        <strong>})</strong></p>
<p>})</p>
<p>};</p>
<p>5ã€é…ç½®queueã€exchangeã€mailbinding</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">Queue mailQueue() &#123;</span><br><span class="line">    return new Queue(MailConstants.MAIL_QUEUE_NAME, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">DirectExchange mailExchange() &#123;</span><br><span class="line">    return new DirectExchange(MailConstants.MAIL_EXCHANGE_NAME, true, false);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">Binding mailBinding() &#123;</span><br><span class="line">    return BindingBuilder.bind(mailQueue()).to(mailExchange()).with(MailConstants.MAIL_ROUTING_KEY_NAME);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6ã€MailConstantså®šä¹‰å¸¸ç”¨å˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class MailConstants &#123;</span><br><span class="line">    public static final Integer DELIVERING = 0;//æ¶ˆæ¯æŠ•é€’ä¸­</span><br><span class="line">    public static final Integer SUCCESS = 1;//æ¶ˆæ¯æŠ•é€’æˆåŠŸ</span><br><span class="line">    public static final Integer FAILURE = 2;//æ¶ˆæ¯æŠ•é€’å¤±è´¥</span><br><span class="line">    public static final Integer MAX_TRY_COUNT = 3;//æœ€å¤§é‡è¯•æ¬¡æ•°</span><br><span class="line">    public static final Integer MSG_TIMEOUT = 1;//æ¶ˆæ¯è¶…æ—¶æ—¶é—´</span><br><span class="line">    public static final String MAIL_QUEUE_NAME = &quot;javaboy.mail.queue&quot;;</span><br><span class="line">    public static final String MAIL_EXCHANGE_NAME = &quot;javaboy.mail.exchange&quot;;</span><br><span class="line">    public static final String MAIL_ROUTING_KEY_NAME = &quot;javaboy.mail.routing.key&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ¶ˆæ¯æŠ•é€’å¤±è´¥"><a href="#æ¶ˆæ¯æŠ•é€’å¤±è´¥" class="headerlink" title="æ¶ˆæ¯æŠ•é€’å¤±è´¥"></a>æ¶ˆæ¯æŠ•é€’å¤±è´¥</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class MailSendTask &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    MailSendLogService mailSendLogService;</span><br><span class="line">    @Autowired</span><br><span class="line">    RabbitTemplate rabbitTemplate;</span><br><span class="line">    @Autowired</span><br><span class="line">    EmployeeService employeeService;</span><br><span class="line">    </span><br><span class="line">    //å®šæ—¶ä»»åŠ¡ï¼šæ¯éš”åç§’è·‘ä¸€æ¬¡</span><br><span class="line">    @Scheduled(cron = &quot;0/10 * * * * ?&quot;)</span><br><span class="line">    public void mailResendTask() &#123;</span><br><span class="line">        //æŸ¥è¯¢è®°å½•è¡¨</span><br><span class="line">        List&lt;MailSendLog&gt; logs = mailSendLogService.getMailSendLogsByStatus();//trytimeè¦å°äºå½“å‰æ—¶é—´</span><br><span class="line">        if (logs == null || logs.size() == 0) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        //éå†</span><br><span class="line">        logs.forEach(mailSendLog-&gt;&#123;</span><br><span class="line">            if (mailSendLog.getCount() &gt;= 3) &#123;</span><br><span class="line">                mailSendLogService.updateMailSendLogStatus(mailSendLog.getMsgId(), 2);//ç›´æ¥è®¾ç½®è¯¥æ¡æ¶ˆæ¯å‘é€å¤±è´¥</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                mailSendLogService.updateCount(mailSendLog.getMsgId(), new Date());</span><br><span class="line">                Employee emp = employeeService.getEmployeeById(mailSendLog.getEmpId());//æ‹¿åˆ°è®°å½•è¡¨é‡Œå‘˜å·¥idå¯¹åº”å‘˜å·¥ä¿¡æ¯ï¼Œç„¶åé‡è¯•</span><br><span class="line">                rabbitTemplate.convertAndSend(MailConstants.MAIL_EXCHANGE_NAME, MailConstants.MAIL_ROUTING_KEY_NAME, emp, new CorrelationData(mailSendLog.getMsgId()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">publisher-returns: true</span><br><span class="line">publisher-confirm-type:</span><br></pre></td></tr></table></figure>

<p>//å¼€å¯confirmå’Œreturnå›è°ƒ</p>
<h2 id="ç›‘å¬"><a href="#ç›‘å¬" class="headerlink" title="ç›‘å¬"></a>ç›‘å¬</h2><p>1ã€å¼€å¯é˜Ÿåˆ—æ¥æ”¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.rabbitmq.listener.simple.acknowledge-mode=manual</span><br><span class="line">spring.rabbitmq.listener.simple.prefetch=100</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class MailserverApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(MailserverApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    Queue queue() &#123;</span><br><span class="line">        return new Queue(MailConstants.MAIL_QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2ã€@listener</p>
<ul>
<li><p> @RabbitListener(queues = MailConstants.MAIL_QUEUE_NAME)</p>
</li>
<li><p>String msgId = (String) headers.get(â€œspring_returned_message_correlationâ€);</p>
</li>
<li><p>if (redisTemplate.opsForHash().entries(â€œmail_logâ€).containsKey(msgId)) {</p>
<p> //redis ä¸­åŒ…å«è¯¥ keyï¼Œè¯´æ˜è¯¥æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹è¿‡</p>
<pre><code>        logger.info(msgId + &quot;:æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹&quot;);
        channel.basicAck(tag, false);//ç¡®è®¤æ¶ˆæ¯å·²æ¶ˆè´¹.  
</code></pre>
</li>
</ul>
<p>  â€‹            return;</p>
<p>  }</p>
<ul>
<li></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">    @RabbitListener(queues = MailConstants.MAIL_QUEUE_NAME)</span><br><span class="line">    public void handler(Message message, Channel channel) throws IOException &#123;</span><br><span class="line">        Employee employee = (Employee) message.getPayload();</span><br><span class="line">        </span><br><span class="line">        MessageHeaders headers = message.getHeaders();</span><br><span class="line">        Long tag = (Long) headers.get(AmqpHeaders.DELIVERY_TAG);//æ¶ˆæ¯æ ‡è®°</span><br><span class="line">        String msgId = (String) headers.get(&quot;spring_returned_message_correlation&quot;);//è·å–å”¯ä¸€æ ‡è®°</span><br><span class="line">        </span><br><span class="line">        if (redisTemplate.opsForHash().entries(&quot;mail_log&quot;).containsKey(msgId)) &#123;</span><br><span class="line">            //redis ä¸­åŒ…å«è¯¥ keyï¼Œè¯´æ˜è¯¥æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹è¿‡</span><br><span class="line">            logger.info(msgId + &quot;:æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹&quot;);</span><br><span class="line">            channel.basicAck(tag, false);//ç¡®è®¤æ¶ˆæ¯å·²æ¶ˆè´¹</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        //æ”¶åˆ°æ¶ˆæ¯ï¼Œå‘é€é‚®ä»¶</span><br><span class="line">        MimeMessage msg = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = new MimeMessageHelper(msg);</span><br><span class="line">        try &#123;</span><br><span class="line">            helper.setTo(employee.getEmail());</span><br><span class="line">            helper.setFrom(mailProperties.getUsername());</span><br><span class="line">            helper.setSubject(&quot;å…¥èŒæ¬¢è¿&quot;);</span><br><span class="line">            helper.setSentDate(new Date());</span><br><span class="line">            Context context = new Context();</span><br><span class="line">            context.setVariable(&quot;name&quot;, employee.getName());</span><br><span class="line">            context.setVariable(&quot;posName&quot;, employee.getPosition().getName());</span><br><span class="line">            context.setVariable(&quot;joblevelName&quot;, employee.getJobLevel().getName());</span><br><span class="line">            context.setVariable(&quot;departmentName&quot;, employee.getDepartment().getName());</span><br><span class="line">            String mail = templateEngine.process(&quot;mail&quot;, context);</span><br><span class="line">            helper.setText(mail, true);</span><br><span class="line">            javaMailSender.send(msg);</span><br><span class="line">            redisTemplate.opsForHash().put(&quot;mail_log&quot;, msgId, &quot;javaboy&quot;);</span><br><span class="line">            channel.basicAck(tag, false);</span><br><span class="line">            logger.info(msgId + &quot;:é‚®ä»¶å‘é€æˆåŠŸ&quot;);</span><br><span class="line">        &#125; catch (MessagingException e) &#123;</span><br><span class="line">            channel.basicNack(tag, false, true);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            logger.error(&quot;é‚®ä»¶å‘é€å¤±è´¥ï¼š&quot; + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h2><p>ä½†æ˜¯ï¼Œåœ¨è¿™æ ·çš„æœºåˆ¶ä¸‹ï¼Œåˆå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æ¶ˆæ¯å¯èƒ½ä¼šé‡å¤æŠ•é€’ï¼Œè¿›è€Œå¯¼è‡´ï¼Œæ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼Œä¾‹å¦‚ä¸€ä¸ªå‘˜å·¥å…¥èŒäº†ï¼Œç»“æœæ”¶åˆ°äº†ä¸¤å°å…¥èŒæ¬¢è¿é‚®ä»¶ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚</p>
<h3 id="å¹‚ç­‰æ€§"><a href="#å¹‚ç­‰æ€§" class="headerlink" title="å¹‚ç­‰æ€§"></a>å¹‚ç­‰æ€§</h3><p>å¹‚ç­‰æ€§æœ¬èº«æ˜¯æ•°å­¦ä¸Šçš„æ¦‚å¿µï¼Œå³ä½¿å…¬å¼ï¼šf(x)=f(f(x)) èƒ½å¤Ÿæˆç«‹çš„æ•°å­¦æ€§è´¨ã€‚åœ¨å¼€å‘é¢†åŸŸï¼Œåˆ™è¡¨ç¤ºå¯¹äºåŒä¸€ä¸ªç³»ç»Ÿï¼Œä½¿ç”¨ç›¸åŒçš„æ¡ä»¶ï¼Œä¸€æ¬¡è¯·æ±‚å’Œå¤šæ¬¡è¯·æ±‚å¯¹ç³»ç»Ÿèµ„æºçš„å½±å“æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¹‚ç­‰æ€§å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°æ¥å£è°ƒç”¨å¤±è´¥è¿›è€Œè¿›è¡Œé‡è¯•è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™æ ·å°±å¸¦æ¥äº†å¯¹ä¸€ä¸ªæ¥å£å¯èƒ½ä¼šä½¿ç”¨ç›¸åŒçš„æ¡ä»¶è¿›è¡Œé‡å¤è°ƒç”¨ï¼Œåœ¨è¿™æ ·çš„æ¡ä»¶ä¸‹ï¼Œä¿è¯æ¥å£çš„å¹‚ç­‰æ€§å°±å°¤ä¸ºé‡è¦äº†ã€‚</p>
<p>äº†è§£äº†é—®é¢˜ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±å¾ˆå¥½æ•´äº†ï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰ï¼š</p>
<ul>
<li>MVCC</li>
<li>Token æœºåˆ¶</li>
<li>è®¾è®¡å»é‡è¡¨</li>
<li>â€¦</li>
</ul>
<p>MVCC æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯åœ¨æ•°æ®æ›´æ–°çš„æ—¶å€™éœ€è¦å»æ¯”è¾ƒæ‰€æŒæœ‰çš„æ•°æ®ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·ä¸ä¸€è‡´çš„è¯ï¼Œæ“ä½œä¼šå¤±è´¥ï¼Œè¿™æ ·æ¯ä¸ª version å°±åªæœ‰ä¸€æ¬¡æ‰§è¡ŒæˆåŠŸçš„æœºä¼šï¼Œä¸€æ—¦å¤±è´¥äº†å¿…é¡»é‡æ–°è·å–ã€‚</p>
<p>Token åˆ™æ˜¯ç›®å‰ä½¿ç”¨æ¯”è¾ƒå¹¿çš„ä¸€ç§æ–¹å¼<strong>ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯æ¯ä¸ªæ“ä½œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€å‡­è¯ token</strong>ï¼Œä¸€æ—¦æ‰§è¡ŒæˆåŠŸï¼Œå¯¹äºé‡å¤çš„è¯·æ±‚ï¼Œæ€»æ˜¯è¿”å›åŒä¸€ä¸ªç»“æœã€‚</p>
<p>è¿™é‡Œ<strong>RabbitMQ æ¶ˆè´¹ç«¯</strong>å®é™…ä¸Šå°±æ˜¯é‡‡ç”¨äº† Token è¿™ç§æ–¹å¼ã€‚</p>
<p>å¤§è‡´çš„æ€è·¯æ˜¯è¿™æ ·ï¼Œ<strong>é¦–å…ˆå°† RabbitMQ çš„æ¶ˆæ¯è‡ªåŠ¨ç¡®è®¤æœºåˆ¶æ”¹ä¸ºæ‰‹åŠ¨ç¡®è®¤ï¼Œç„¶åæ¯å½“æœ‰ä¸€æ¡æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸäº†ï¼Œå°±æŠŠè¯¥æ¶ˆæ¯çš„å”¯ä¸€ ID è®°å½•åœ¨ Redis ä¸Š</strong>ï¼Œç„¶åæ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œéƒ½å…ˆå» Redis ä¸ŠæŸ¥çœ‹æ˜¯å¦æœ‰è¯¥æ¶ˆæ¯çš„ IDï¼Œå¦‚æœæœ‰ï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯å·²ç»æ¶ˆè´¹è¿‡äº†ï¼Œä¸å†å¤„ç†ï¼Œå¦åˆ™å†å»å¤„ç†ã€‚</p>
<h3 id="å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥"><a href="#å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥" class="headerlink" title="å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥"></a>å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥</h3><p>è‡ªåŠ¨é€€å›rabbitmqï¼ï¼ï¼</p>
<p>æ¯”å¦‚æ‰§è¡Œæ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸</p>
<p><img src="https://i.loli.net/2021/06/01/cCkuLtoDrvUbVSZ.png" alt="image-20210601175411320.png"></p>
<p>unackedä¸º1</p>
<p>é‡è¯•å°±å¯èƒ½äº§ç”Ÿå¤šæ¬¡æ¶ˆè´¹çš„é—®é¢˜ï¼ï¼ï¼</p>
<p> public void handler(Message message, Channel channel) throws IOException {</p>
<p>}</p>
<p><strong>channelç”¨æ¥æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æ¶ˆè´¹æˆåŠŸ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Long tag = (Long) headers.get(AmqpHeaders.DELIVERY_TAG);//æ¶ˆæ¯æ ‡è®°</span><br><span class="line"> String msgId = (String) headers.get(&quot;spring_returned_message_correlation&quot;);//è·å–å”¯ä¸€æ ‡è®°</span><br></pre></td></tr></table></figure>



<p>é‚®ä»¶å‘é€æˆåŠŸ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">channel.basicAck(tag, false);//ç¡®è®¤æ¶ˆæ¯å·²æ¶ˆè´¹ï¼Œfasleè¡¨ç¤ºä¸¢å¼ƒå³å¯</span><br><span class="line"></span><br><span class="line">redisTemplate.opsForHash().put(&quot;mail_log&quot;, msgId, &quot;javaboy&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * å¾€Hashä¸­å­˜å…¥æ•°æ®</span><br><span class="line"> *</span><br><span class="line"> * @param key Redisé”®</span><br><span class="line"> * @param hKey Hashé”®</span><br><span class="line"> * @param value å€¼</span><br><span class="line"> */</span><br><span class="line">public &lt;T&gt; void setCacheMapValue(final String key, final String hKey, final T value)</span><br><span class="line">&#123;</span><br><span class="line">    redisTemplate.opsForHash().put(key, hKey, value);</span><br><span class="line">&#125;</span><br><span class="line">//å–å€¼</span><br><span class="line">opsForHash().entries(&quot;mail_log&quot;).containsKey(msgId)</span><br></pre></td></tr></table></figure>

<p>é‚®ä»¶å‘é€å¤±è´¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.basicNack(tag, false, true);//trueè¡¨ç¤ºå›åˆ°æ¶ˆæ¯é˜Ÿåˆ—</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/12/mq%E5%B0%8F%E8%AE%B0/" data-id="ckpe515zz0006zu0t7t1tflkn" data-title="mqå°è®°" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rabbitmq/" rel="tag">rabbitmq</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ThreadLocalå°ç»“" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/10/ThreadLocal%E5%B0%8F%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-05-10T01:57:40.000Z" itemprop="datePublished">2021-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">å¤šçº¿ç¨‹</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/10/ThreadLocal%E5%B0%8F%E7%BB%93/">ThreadLocalå°ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h1><p>æ•°æ®åº“è¿æ¥æ± ä¸­æ˜¯å°†connectionæ”¾è¿›threadï¼ï¼ï¼</p>
<p>1ã€threadlocalæ˜¯ä¸ºäº†åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆ›å»ºäº†å‰¯æœ¬</p>
<p>2ã€ç¡®ä¿ç»Ÿä¸€çº¿ç¨‹ä¹‹é—´å‚æ•°ä¼ é€’çš„æ–¹ä¾¿</p>
<h2 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h2><p>1ã€ä¸€ä¸ªç”¨æˆ·è¯·æ±‚å°±ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚è€Œæˆ‘ä»¬æŠŠconnectionæ”¾åœ¨ThreadLocalé‡Œçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç¨‹åºåªéœ€è¦ä¸€ä¸ªconnectioné“¾æ¥æ•°æ®åº“å°±å¯ä»¥äº†ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ç”¨çš„connectionçš„ä¸€ä¸ªå‰¯æœ¬ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨æ•°æ®åº“è¿æ¥æ± å‘¢ï¼Ÿ</p>
<p>2ã€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå‰¯æœ¬é‡Œçš„connectionæ‰§è¡Œäº†å…³é—­æ“ä½œï¼Œå…¶ä»–éƒ½æ²¡æ‰§è¡Œã€‚é‚£ä¹ˆçœŸæ­£ä¸æ•°æ®åº“è¿æ¥çš„connectionä»€ä¹ˆæ—¶å€™å…³é—­å‘¢ï¼Ÿ</p>
<p>3ã€ä»€ä¹ˆæ—¶å€™æ˜¯ä»æ•°æ®åº“è¿æ¥æ± é‡Œå–connectionè€Œä»€ä¹ˆæ—¶å€™è·å¾—çš„æ˜¯connectionçš„ä¸€ä¸ªthreadlocalå‰¯æœ¬ï¼Ÿ</p>
<h4 id="å…³é”®ï¼š"><a href="#å…³é”®ï¼š" class="headerlink" title="å…³é”®ï¼š"></a>å…³é”®ï¼š</h4><p>è¿æ¥æ± æ˜¯ç¼“å­˜å¹¶æ‰˜ç®¡æ•°æ®åº“è¿æ¥ï¼Œä¸»è¦æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚</p>
<p>è€ŒThreadLocalç¼“å­˜è¿æ¥ï¼Œ<strong>æ˜¯ä¸ºäº†æŠŠåŒä¸€ä¸ªæ•°æ®åº“è¿æ¥â€œåˆ†äº«â€ç»™åŒä¸€ä¸ªçº¿ç¨‹çš„ä¸åŒè°ƒç”¨æ–¹æ³•</strong>ã€‚ï¼ˆä¸ç®¡è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªè¿æ¥ï¼Œæ–¹ä¾¿è¿›è¡Œâ€œè·¨æ–¹æ³•â€çš„äº‹åŠ¡æ§åˆ¶ï¼‰</p>
<h4 id="ä¸¾ä¾‹ï¼š"><a href="#ä¸¾ä¾‹ï¼š" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h4><p>å¦‚æœä¸€ä¸ªè¯·æ±‚ä¸­æ¶‰åŠå¤šä¸ª DAO æ“ä½œï¼Œè€Œå¦‚æœè¿™äº›DAOä¸­çš„Connectionéƒ½æ˜¯ç‹¬ç«‹çš„è¯ï¼Œ<strong>å°±æ²¡æœ‰åŠæ³•å®Œæˆä¸€ä¸ªäº‹åŠ¡</strong>ã€‚ä½†æ˜¯å¦‚æœDAO ä¸­çš„ Connection æ˜¯ä» ThreadLocal ä¸­è·å¾—çš„ï¼ˆæ„å‘³ç€éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œ <strong>é‚£ä¹ˆè¿™äº› DAO å°±ä¼šè¢«çº³å…¥åˆ°åŒä¸€ä¸ª Connection ä¹‹ä¸‹</strong>ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯è¿æ¥æ± ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¿æ¥æ± ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿æ¥æ± ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¿æ¥æ± ï¼Ÿ</h2><p>è¿æ¥æ± é‡Œé¢æœ‰ä¸€å®šæ•°é‡çš„è¿æ¥èµ„æºï¼Œæ¯”å¦‚æœ€å¤§20ä¸ªè¿æ¥ã€‚</p>
<p>åº•å±‚æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.sql.DriverManager.getConnection(url, props);</span><br><span class="line"></span><br><span class="line">java.sql.Driver.connect(url, props);</span><br></pre></td></tr></table></figure>

<p>ç‰¹ç‚¹æ˜¯ï¼šè¦ä¼ å…¥urlã€ç”¨æˆ·åå’Œå¯†ç ç­‰ä¿¡æ¯</p>
<p>è¿™ç§æ–¹å¼ï¼Œè‚¯å®šå°±æ²¡æœ‰ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ã€‚</p>
<p>ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼Œé€š<strong>å¸¸éƒ½æ˜¯å¾—åˆ°ä¸€ä¸ªæ‰€è°“çš„javax.sql.DataSource[æ¥å£]çš„å®ä¾‹å¯¹è±¡</strong>ï¼Œå®ƒé‡Œé¢<strong>åŒ…å«äº†Connection</strong>ï¼Œå¹¶ä¸”æ•°æ®åº“è¿æ¥æ± å·¥å…·ç±»ï¼ˆæ¯”å¦‚C3P0ã€JNDIã€DBCPç­‰ï¼‰ï¼Œè‚¯å®šæ˜¯<strong>é‡æ–°å®šä¹‰äº†getConnectionã€closeConnection</strong>ç­‰æ–¹æ³•</p>
<p><strong>æ‰€ä»¥ä½ æ¯æ¬¡å¾—åˆ°çš„Connectionï¼Œå‡ ä¹éƒ½ä¸æ˜¯æ–°å»ºç«‹çš„è¿æ¥ï¼ˆè€Œæ˜¯å·²ç»å»ºç«‹å¥½å¹¶æ”¾åˆ°ç¼“å­˜é‡Œé¢çš„è¿æ¥ï¼‰</strong>ï¼Œä½ è°ƒç”¨closeConnectionæ–¹æ³•ï¼Œä¹Ÿ<strong>ä¸æ˜¯çœŸæ­£çš„å…³é—­è¿æ¥</strong>ï¼ˆä¸€èˆ¬éƒ½æ˜¯èµ·åˆ°ä¸€ä¸ªæ ‡è¯†ä½œç”¨ï¼Œæ ‡è¯†å½“å‰è¿æ¥å·²ç»ä½¿ç”¨å®Œæ¯•ï¼Œå½’è¿˜ç»™è¿æ¥æ± ï¼Œè®©è¿™ä¸ªè¿æ¥å¤„äºå¾…åˆ†é…çŠ¶æ€ï¼‰</p>
<h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>ä¸åŒçš„çº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶é—´ï¼ˆ <strong>æˆ–è€… åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤šä¸ªåœ°æ–¹</strong>ï¼‰ä»è¿æ¥æ± ä¸­æ‹¿åˆ°çš„Connectionï¼Œè‚¯å®šä¸æ˜¯åŒä¸€ä¸ªè¿æ¥ã€‚</p>
<p>ï¼ˆåè¿‡æ¥è®²ï¼šä¸åŒæ—¶é—´çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€å‰ä¸€åï¼Œåˆ™æœ‰å¯èƒ½æ‹¿åˆ°åŒä¸€ä¸ªè¿æ¥ï¼‰</p>
<p>1ã€å‡è®¾åŒä¸€æ—¶é—´å¤šä¸ªçº¿ç¨‹ä»æ•°æ®åº“è¿æ¥æ± è·å–è¿æ¥ï¼Œé‚£è‚¯å®šæ‹¿çš„æ˜¯ä¸åŒçš„è¿æ¥ï¼Œæˆ‘å½“å‰çº¿ç¨‹å’Œåˆ«çš„çº¿ç¨‹æ‹¿çš„è¿æ¥ä¸ä¸€æ ·ï¼Œé‚£æˆ‘å½“å‰åœ¨crudçš„æ—¶å€™ï¼Œä¸åœ¨ä¸€ä¸ªäº‹åŠ¡ä¹‹å†…ã€‚</p>
<p>2ã€å‡è®¾ä¸åŒæ—¶é—´çš„å¤šä¸ªçº¿ç¨‹è¦ä»æ•°æ®åº“è¿æ¥æ± æ‹¿è¿æ¥ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±å¯èƒ½æ‹¿åˆ°çš„æ˜¯åŒä¸€ä¸ªè¿æ¥äº†ï¼Œé‚£æˆ‘<strong>å¤šä¸ªçº¿ç¨‹çº¿ç¨‹æ‹¿åˆ°çš„æ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ï¼ï¼</strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¹‹å†…ï¼Œçº¿ç¨‹aæ‰§è¡Œäº†æ’å…¥è¿˜æ²¡æ¥å¾—åŠæäº¤ï¼Œçº¿ç¨‹bæ­¤æ—¶æ¥äº†ä¸ªæ›´æ–°ï¼Œåœ¨çº¿ç¨‹aè¿˜æœªæ“ä½œå®Œä¹‹å‰ï¼Œçº¿ç¨‹bæ›´æ–°å®Œäº†åï¼Œ<strong>ç›´æ¥æŠŠè¿æ¥ç»™closeäº†ï¼Œçº¿ç¨‹aæ’äº†ä¸€åŠå‘ç°æ’ä¸äº†äº†ï¼ï¼ï¼ï¼</strong></p>
<p>ä¸ºäº†ç¡®ä¿ä¸åŒæ—¶é—´å¤šä¸ªçº¿ç¨‹å¯èƒ½æ‹¿åˆ°çš„æ˜¯åŒä¸€ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆæ­¤æ—¶threadlocalé—ªäº®ç™»åœºï¼Œå°±ç®—æˆ‘æ‹¿çš„æ˜¯â€œåŒä¸€ä¸ªè¿æ¥â€ï¼Œåœ¨å¼•å…¥äº†threadlocalåï¼Œ<strong>æ¯ä¸ªçº¿ç¨‹ä¹‹é—´éƒ½ä¼šåˆ›å»ºç‹¬ç«‹çš„è¿æ¥å‰¯æœ¬ï¼Œå°†collectionå„è‡ªcopyä¸€ä»½ï¼Œè¿™æ ·å°±äº’ç›¸ä¸å¹²æ‰°äº†ï¼ˆè¿™æ ·çº¿ç¨‹Açš„closeå°±ä¸ä¼šå½±å“çº¿ç¨‹Bçš„äº‹åŠ¡ï¼Œå› ä¸ºä¸­é—´è¿˜æœ‰ä¸ªè¿æ¥æ± ç®¡ç†ï¼ˆcloseæ–¹æ³•å·²ç»è¢«é‡æ–°å®šä¹‰ï¼‰ï¼‰ã€‚</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/10/ThreadLocal%E5%B0%8F%E7%BB%93/" data-id="ckpe515zx0004zu0tbd1g3cjl" data-title="ThreadLocalå°ç»“" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-AOPåº”ç”¨" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/07/AOP%E5%BA%94%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2021-05-07T13:47:45.000Z" itemprop="datePublished">2021-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/spring/">spring</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/07/AOP%E5%BA%94%E7%94%A8/">AOPåº”ç”¨</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><p>ç®€å•åœ°å»ç†è§£ï¼Œå…¶å®AOPè¦åšä¸‰ç±»äº‹ï¼š</p>
<ul>
<li>åœ¨å“ªé‡Œåˆ‡å…¥ï¼Œä¹Ÿå°±æ˜¯æƒé™æ ¡éªŒç­‰éä¸šåŠ¡æ“ä½œåœ¨å“ªäº›ä¸šåŠ¡ä»£ç ä¸­æ‰§è¡Œã€‚</li>
<li>åœ¨ä»€ä¹ˆæ—¶å€™åˆ‡å…¥ï¼Œæ˜¯ä¸šåŠ¡ä»£ç æ‰§è¡Œå‰è¿˜æ˜¯æ‰§è¡Œåã€‚</li>
<li>åˆ‡å…¥ååšä»€ä¹ˆäº‹ï¼Œæ¯”å¦‚åšæƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ç­‰ã€‚</li>
</ul>
<p><img src="https://i.loli.net/2021/05/31/RrDWGu7ksYiHLSV.png" alt="image-20210531211709437.png"></p>
<p>éš¾æ‡‚ç‚¹ï¼š</p>
<p>â€‹         ç»‡å…¥ï¼šå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œåœ¨ç›®æ ‡å¯¹è±¡æ–¹æ³•ä¸­æ‰§è¡Œå¤„ç†å†…å®¹çš„è¿‡ç¨‹ã€‚</p>
<h1 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h1><h3 id="è¯¥ä¾‹çš„åœºæ™¯æ˜¯ï¼š"><a href="#è¯¥ä¾‹çš„åœºæ™¯æ˜¯ï¼š" class="headerlink" title="è¯¥ä¾‹çš„åœºæ™¯æ˜¯ï¼š"></a>è¯¥ä¾‹çš„åœºæ™¯æ˜¯ï¼š</h3><ol>
<li>è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£<code>PermissionsAnnotation</code></li>
<li>åˆ›å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œåˆ‡ç‚¹è®¾ç½®ä¸ºæ‹¦æˆªæ‰€æœ‰æ ‡æ³¨<code>PermissionsAnnotation</code>çš„æ–¹æ³•ï¼Œæˆªå–åˆ°æ¥å£çš„å‚æ•°ï¼Œè¿›è¡Œç®€å•çš„æƒé™æ ¡éªŒ</li>
<li>å°†<code>PermissionsAnnotation</code>æ ‡æ³¨åœ¨æµ‹è¯•æ¥å£ç±»çš„æµ‹è¯•æ¥å£<code>test</code>ä¸Š</li>
</ol>
<h3 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h3><ol>
<li>ä½¿ç”¨<code>@Targetã€@Retentionã€@Documented</code>è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">public @interface PermissionAnnotation&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>åˆ›å»ºç¬¬ä¸€ä¸ªAOPåˆ‡é¢ç±»</p>
<p>åªè¦åœ¨ç±»ä¸ŠåŠ ä¸ª <code>@Aspect</code> æ³¨è§£å³å¯ã€‚</p>
<p>@Aspect<code> æ³¨è§£ç”¨æ¥æè¿°ä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå®šä¹‰åˆ‡é¢ç±»çš„æ—¶å€™éœ€è¦æ‰“ä¸Šè¿™ä¸ªæ³¨è§£ã€‚</code></p>
<p>@Component` æ³¨è§£å°†è¯¥ç±»äº¤ç»™ Spring æ¥ç®¡ç†ã€‚</p>
<p>åœ¨è¿™ä¸ªç±»é‡Œå®ç°ç¬¬ä¸€æ­¥æƒé™æ ¡éªŒé€»è¾‘ï¼š</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.aspectj.lang.annotation.Pointcut;</span><br><span class="line">import org.springframework.core.annotation.Order;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">@Order(1)</span><br><span class="line">public class PermissionFirstAdvice &#123;</span><br><span class="line"></span><br><span class="line">    // å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼ŒğŸ˜€æ‹¬å·å†…å†™å…¥ç¬¬1æ­¥ä¸­è‡ªå®šä¹‰æ³¨è§£çš„è·¯å¾„ğŸ˜€</span><br><span class="line">    //@Pointcut æ³¨è§£ï¼Œç”¨æ¥å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œå³ä¸Šæ–‡ä¸­æ‰€å…³æ³¨çš„æŸä»¶äº‹æƒ…çš„å…¥å£ï¼Œåˆ‡å…¥ç‚¹å®šä¹‰äº†äº‹ä»¶è§¦å‘æ—¶æœºã€‚</span><br><span class="line">    //å¦ä¸€ç§å†™æ³•ï¼š @Pointcut(&quot;execution(* com.mutest.controller..*.*(..))&quot;)</span><br><span class="line">    //å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œæ‹¦æˆª com.itcodai.course09.controller åŒ…å’Œå­åŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•</span><br><span class="line">    @Pointcut(&quot;@annotation(com.mu.demo.annotation.PermissionAnnotation)&quot;)</span><br><span class="line">    private void permissionCheck() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //â­ï¸â­ï¸â­ï¸</span><br><span class="line">    //1ã€@Aroundå¯ä»¥è‡ªç”±é€‰æ‹©å¢å¼ºåŠ¨ä½œä¸ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨å¢å¼ºåŠ¨ä½œå‰åï¼Œç”šè‡³è¿‡ç¨‹ä¸­æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚è¿™ä¸ªç‰¹æ€§çš„å®ç°åœ¨äºï¼Œè°ƒç”¨ProceedingJoinPointå‚æ•°çš„procedd()æ–¹æ³•æ‰ä¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</span><br><span class="line">    // å®ç°@Afteræ•ˆæœ</span><br><span class="line">    // Object rvt = jp.proceed(args);  </span><br><span class="line">    // System.out.println(&quot;æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹åï¼Œæ¨¡æ‹Ÿç»“æŸäº‹åŠ¡...&quot;);  </span><br><span class="line">    // ......</span><br><span class="line">    //2ã€@Aroundå¯ä»¥æ”¹å˜æ‰§è¡Œç›®æ ‡æ–¹æ³•çš„å‚æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ”¹å˜æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹åçš„è¿”å›å€¼ã€‚</span><br><span class="line">    </span><br><span class="line">    @Around(&quot;permissionCheck()&quot;)   //ä¸Šé¢çš„permissionCheck()æ–¹æ³•</span><br><span class="line">    public Object permissionCheckFirst(ProceedingJoinPoint joinPoint) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;===================ç¬¬ä¸€ä¸ªåˆ‡é¢===================ï¼š&quot; + System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">        //è·å–è¯·æ±‚å‚æ•°ï¼Œè¯¦è§æ¥å£ç±»</span><br><span class="line">        Object[] objects = joinPoint.getArgs();</span><br><span class="line">        Long id = ((JSONObject) objects[0]).getLong(&quot;id&quot;);</span><br><span class="line">        String name = ((JSONObject) objects[0]).getString(&quot;name&quot;);</span><br><span class="line">        System.out.println(&quot;id1-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot; + id);</span><br><span class="line">        System.out.println(&quot;name1-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot; + name);</span><br><span class="line"></span><br><span class="line">        // idå°äº0åˆ™æŠ›å‡ºéæ³•idçš„å¼‚å¸¸</span><br><span class="line">        if (id &lt; 0) &#123;</span><br><span class="line">            return JSON.parseObject(&quot;&#123;\&quot;message\&quot;:\&quot;illegal id\&quot;,\&quot;code\&quot;:403&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return joinPoint.proceed();//è¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªObject[ ]å¯¹è±¡ï¼Œè¯¥æ•°ç»„ä¸­çš„å€¼å°†è¢«ä¼ å…¥ç›®æ ‡æ–¹æ³•ä½œä¸ºå®å‚</span><br><span class="line">        </span><br><span class="line">        // ä¿®æ”¹å…¥å‚</span><br><span class="line">        //JSONObject object = new JSONObject();</span><br><span class="line">        //object.put(&quot;id&quot;, 8);</span><br><span class="line">        //object.put(&quot;name&quot;, &quot;lisi&quot;);</span><br><span class="line">        //objects[0] = object;</span><br><span class="line">  </span><br><span class="line">        // å°†ä¿®æ”¹åçš„å‚æ•°ä¼ å…¥</span><br><span class="line">        //return joinPoint.proceed(objects);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åˆ›å»ºæ¥å£ç±»</p>
<p>å¹¶åœ¨ç›®æ ‡æ–¹æ³•ä¸Šæ ‡æ³¨è‡ªå®šä¹‰æ³¨è§£ <code>PermissionsAnnotation</code>ï¼š</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/permission&quot;)</span><br><span class="line">public class TestController &#123;</span><br><span class="line">    @RequestMapping(value = &quot;/check&quot;, method = RequestMethod.POST)</span><br><span class="line">    // æ·»åŠ è¿™ä¸ªæ³¨è§£</span><br><span class="line">    @PermissionsAnnotation()</span><br><span class="line">    public JSONObject getGroupList(@RequestBody JSONObject request) &#123;</span><br><span class="line">        return JSON.parseObject(&quot;&#123;\&quot;message\&quot;:\&quot;SUCCESS\&quot;,\&quot;code\&quot;:200&#125;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¡¥å……ï¼š</p>
<p>1ã€@Before</p>
<p><code>@Before</code> æ³¨è§£æŒ‡å®šçš„æ–¹æ³•åœ¨åˆ‡é¢åˆ‡å…¥ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥åšä¸€äº› <code>Log</code> å¤„ç†ï¼Œä¹Ÿå¯ä»¥åšä¸€äº›ä¿¡æ¯çš„ç»Ÿè®¡ï¼Œæ¯”å¦‚è·å–ç”¨æˆ·çš„è¯·æ±‚ <code>URL</code> ä»¥åŠç”¨æˆ·çš„ <code>IP</code> åœ°å€ç­‰ç­‰ï¼Œè¿™ä¸ªåœ¨åšä¸ªäººç«™ç‚¹çš„æ—¶å€™éƒ½èƒ½ç”¨å¾—åˆ°ï¼Œéƒ½æ˜¯å¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<p>2ã€@After</p>
<p><code>@After</code> æ³¨è§£å’Œ <code>@Before</code> æ³¨è§£ç›¸å¯¹åº”ï¼ŒæŒ‡å®šçš„æ–¹æ³•åœ¨åˆ‡é¢åˆ‡å…¥ç›®æ ‡æ–¹æ³•ä¹‹åæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åšä¸€äº›å®ŒæˆæŸæ–¹æ³•ä¹‹åçš„ Log å¤„ç†ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/07/AOP%E5%BA%94%E7%94%A8/" data-id="ckpe515zp0000zu0tfdenhcen" data-title="AOPåº”ç”¨" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AOP/" rel="tag">AOP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-å…³äºè™šæ‹Ÿæœºä¸­çš„åƒåœ¾å›æ”¶" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/05/%E5%85%B3%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" class="article-date">
  <time class="dt-published" datetime="2021-05-05T08:20:06.000Z" itemprop="datePublished">2021-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">JavaåŸºç¡€</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/05/%E5%85%B3%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">å…³äºè™šæ‹Ÿæœºä¸­çš„åƒåœ¾å›æ”¶</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Java-è™šæ‹Ÿæœºå¯ä»¥ç»™ä¸åŒä»£ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•"><a href="#Java-è™šæ‹Ÿæœºå¯ä»¥ç»™ä¸åŒä»£ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•" class="headerlink" title="Java è™šæ‹Ÿæœºå¯ä»¥ç»™ä¸åŒä»£ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•"></a>Java è™šæ‹Ÿæœºå¯ä»¥ç»™ä¸åŒä»£ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•</h1><h2 id="å¯¹äºæ–°ç”Ÿä»£"><a href="#å¯¹äºæ–°ç”Ÿä»£" class="headerlink" title="å¯¹äºæ–°ç”Ÿä»£"></a>å¯¹äºæ–°ç”Ÿä»£</h2><p>çŒœæµ‹å¤§éƒ¨åˆ†çš„Javaå¯¹è±¡åªå­˜æ´»ä¸€å°æ®µæ—¶é—´ï¼Œä¾¿å¯ä»¥é‡‡ç”¨è€—æ—¶æ¯”è¾ƒçŸ­çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œè®©å¤§éƒ¨åˆ†çš„åƒåœ¾åœ¨æ–°ç”Ÿä»£è¢«å›æ”¶æ‰ã€‚</p>
<h3 id="ä¸»è¦é’ˆå¯¹æ–°ç”Ÿä»£çš„Minor-GC"><a href="#ä¸»è¦é’ˆå¯¹æ–°ç”Ÿä»£çš„Minor-GC" class="headerlink" title="ä¸»è¦é’ˆå¯¹æ–°ç”Ÿä»£çš„Minor GC"></a>ä¸»è¦é’ˆå¯¹æ–°ç”Ÿä»£çš„Minor GC</h3><h4 id="1ã€-å †-çš„åˆ’åˆ†"><a href="#1ã€-å †-çš„åˆ’åˆ†" class="headerlink" title="1ã€==å †==çš„åˆ’åˆ†"></a>1ã€==å †==çš„åˆ’åˆ†</h4><p>Java è™šæ‹Ÿæœºå°†å †åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚å…¶ä¸­ï¼Œæ–°ç”Ÿä»£åˆè¢«åˆ’åˆ†ä¸º Eden åŒºï¼Œä»¥åŠä¸¤ä¸ªå¤§å°ç›¸åŒçš„ Survivor åŒºã€‚</p>
<p><img src="https://i.loli.net/2021/05/31/9bZkxIRrdp1m6Pt.png" alt="æˆªå±2021-05-31 ä¸‹åˆ4.27.10.png"></p>
<p>å½“æˆ‘ä»¬è°ƒç”¨ new æŒ‡ä»¤æ—¶ï¼Œå®ƒä¼šåœ¨ Eden åŒºä¸­åˆ’å‡ºä¸€å—ä½œä¸ºå­˜å‚¨å¯¹è±¡çš„å†…å­˜ã€‚==ç”±äºå †ç©ºé—´æ˜¯çº¿ç¨‹å…±äº«çš„==ï¼Œå› æ­¤ç›´æ¥åœ¨è¿™é‡Œè¾¹åˆ’ç©ºé—´æ˜¯éœ€è¦è¿›è¡ŒåŒæ­¥çš„ï¼ˆå¦åˆ™ï¼Œå°†æœ‰å¯èƒ½å‡ºç°ä¸¤ä¸ªå¯¹è±¡å…±ç”¨ä¸€æ®µå†…å­˜çš„äº‹æ•…ï¼‰ã€‚</p>
<h5 id="å½“-Eden-åŒºçš„ç©ºé—´è€—å°½äº†æ€ä¹ˆåŠï¼Ÿ"><a href="#å½“-Eden-åŒºçš„ç©ºé—´è€—å°½äº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å½“ Eden åŒºçš„ç©ºé—´è€—å°½äº†æ€ä¹ˆåŠï¼Ÿ"></a>å½“ Eden åŒºçš„ç©ºé—´è€—å°½äº†æ€ä¹ˆåŠï¼Ÿ</h5><p>è¿™ä¸ªæ—¶å€™ Java è™šæ‹Ÿæœºä¾¿ä¼šè§¦å‘ä¸€æ¬¡ Minor GCï¼Œæ¥æ”¶é›†æ–°ç”Ÿä»£çš„åƒåœ¾ã€‚å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ï¼Œåˆ™ä¼šè¢«é€åˆ° Survivor åŒºã€‚</p>
<p>æ–°ç”Ÿä»£å…±æœ‰ä¸¤ä¸ª Survivor åŒºï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨ from å’Œ to æ¥æŒ‡ä»£ã€‚å…¶ä¸­ to æŒ‡å‘çš„ Survivior åŒºæ˜¯ç©ºçš„ã€‚</p>
<h5 id="å½“å‘ç”Ÿ-Minor-GC-æ—¶ï¼ï¼ï¼"><a href="#å½“å‘ç”Ÿ-Minor-GC-æ—¶ï¼ï¼ï¼" class="headerlink" title="å½“å‘ç”Ÿ Minor GC æ—¶ï¼ï¼ï¼"></a>å½“å‘ç”Ÿ Minor GC æ—¶ï¼ï¼ï¼</h5><p>Eden åŒºå’Œ from æŒ‡å‘çš„ Survivor åŒºä¸­çš„å­˜æ´»å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ° to æŒ‡å‘çš„ Survivor åŒºä¸­ï¼Œç„¶å==äº¤æ¢ from å’Œ to æŒ‡é’ˆ==ï¼Œä»¥ä¿è¯ä¸‹ä¸€æ¬¡ Minor GC æ—¶ï¼Œto æŒ‡å‘çš„ Survivor åŒºè¿˜æ˜¯ç©ºçš„ã€‚</p>
<h5 id="ä½•æ—¶æ™‹å‡è€å¹´ä»£ï¼Ÿ"><a href="#ä½•æ—¶æ™‹å‡è€å¹´ä»£ï¼Ÿ" class="headerlink" title="ä½•æ—¶æ™‹å‡è€å¹´ä»£ï¼Ÿ"></a>ä½•æ—¶æ™‹å‡è€å¹´ä»£ï¼Ÿ</h5><p>Java è™šæ‹Ÿæœºä¼šè®°å½• Survivor åŒºä¸­çš„å¯¹è±¡ä¸€å…±è¢«æ¥å›å¤åˆ¶äº†å‡ æ¬¡ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å¤åˆ¶çš„æ¬¡æ•°ä¸º 15ï¼ˆå¯¹åº”è™šæ‹Ÿæœºå‚æ•° -XX:+MaxTenuringThresholdï¼‰ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°†è¢«æ™‹å‡ï¼ˆpromoteï¼‰è‡³è€å¹´ä»£ã€‚å¦å¤–ï¼Œå¦‚æœå•ä¸ª Survivor åŒºå·²ç»è¢«å ç”¨äº† 50%ï¼ˆå¯¹åº”è™šæ‹Ÿæœºå‚æ•° -XX:TargetSurvivorRatioï¼‰ï¼Œé‚£ä¹ˆè¾ƒé«˜å¤åˆ¶æ¬¡æ•°çš„å¯¹è±¡ä¹Ÿä¼šè¢«æ™‹å‡è‡³è€å¹´ä»£ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œå½“å‘ç”Ÿ Minor GC æ—¶ï¼Œæˆ‘ä»¬åº”ç”¨äº†æ ‡è®° - å¤åˆ¶ç®—æ³•ï¼ˆç†æƒ³æƒ…å†µä¸‹ï¼ŒEden åŒºä¸­çš„å¯¹è±¡åŸºæœ¬éƒ½æ­»äº¡äº†ï¼Œé‚£ä¹ˆ==éœ€è¦å¤åˆ¶çš„æ•°æ®å°†éå¸¸å°‘==ï¼Œå› æ­¤é‡‡ç”¨è¿™ç§æ ‡è®° - å¤åˆ¶ç®—æ³•çš„æ•ˆæœæå¥½ï¼‰ï¼Œå°† Survivor åŒºä¸­çš„è€å­˜æ´»å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ï¼Œç„¶åå°†==å‰©ä¸‹çš„å­˜æ´»å¯¹è±¡====å’Œ Eden åŒºçš„å­˜æ´»å¯¹è±¡==å¤åˆ¶åˆ°==å¦ä¸€ä¸ª Survivor åŒºï¼ˆtoï¼‰==ä¸­ã€‚</p>
<h5 id="ä»€ä¹ˆæ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Ÿ</h5><p>ä¼˜ç‚¹ï¼šè§£å†³äº†å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</p>
<p>ç¼ºç‚¹ï¼šå°†åŸæ¥çš„å†…å­˜ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠï¼Œå­˜æ´»å¯¹è±¡è¶Šå¤šæ•ˆç‡è¶Šä½ã€‚</p>
<p><img src="https://i.loli.net/2021/05/31/ASNhKnjFz5W2PdD.png" alt="image-20210531164734367.png"></p>
<h5 id="Minor-GC-çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ä¸ç”¨å¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾å›æ”¶ã€‚"><a href="#Minor-GC-çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ä¸ç”¨å¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾å›æ”¶ã€‚" class="headerlink" title="Minor GC çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ä¸ç”¨å¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾å›æ”¶ã€‚"></a>Minor GC çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯ä¸ç”¨å¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</h5><p>ä½†æ˜¯ï¼Œå®ƒå´æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ==é‚£å°±æ˜¯è€å¹´ä»£çš„å¯¹è±¡å¯èƒ½å¼•ç”¨æ–°ç”Ÿä»£çš„å¯¹è±¡==ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ ‡è®°å­˜æ´»å¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰«æè€å¹´ä»£ä¸­çš„å¯¹è±¡ã€‚å¦‚æœè¯¥å¯¹è±¡æ‹¥æœ‰å¯¹æ–°ç”Ÿä»£å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ä¹Ÿä¼šè¢«ä½œä¸º GC Rootsã€‚</p>
<h5 id="è¿™æ ·ä¸€æ¥ï¼Œå²‚ä¸æ˜¯åˆåšäº†ä¸€æ¬¡å…¨å †æ‰«æå‘¢ï¼Ÿ"><a href="#è¿™æ ·ä¸€æ¥ï¼Œå²‚ä¸æ˜¯åˆåšäº†ä¸€æ¬¡å…¨å †æ‰«æå‘¢ï¼Ÿ" class="headerlink" title="è¿™æ ·ä¸€æ¥ï¼Œå²‚ä¸æ˜¯åˆåšäº†ä¸€æ¬¡å…¨å †æ‰«æå‘¢ï¼Ÿ"></a>è¿™æ ·ä¸€æ¥ï¼Œå²‚ä¸æ˜¯åˆåšäº†ä¸€æ¬¡å…¨å †æ‰«æå‘¢ï¼Ÿ</h5><p>HotSpot ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸€é¡¹å«åšå¡è¡¨ï¼ˆCard Tableï¼‰çš„æŠ€æœ¯ã€‚</p>
<p>è¯¥æŠ€æœ¯å°†æ•´ä¸ªå †åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªå¤§å°ä¸º 512 å­—èŠ‚çš„å¡ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªå¡è¡¨ï¼Œç”¨æ¥å­˜å‚¨æ¯å¼ å¡çš„ä¸€ä¸ªæ ‡è¯†ä½ã€‚==è¿™ä¸ªæ ‡è¯†ä½ä»£è¡¨å¯¹åº”çš„å¡æ˜¯å¦å¯èƒ½å­˜æœ‰æŒ‡å‘æ–°ç”Ÿä»£å¯¹è±¡çš„å¼•ç”¨ã€‚==å¦‚æœå¯èƒ½å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºè¿™å¼ å¡æ˜¯è„çš„ã€‚</p>
<p>åœ¨è¿›è¡Œ Minor GC çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä¸ç”¨æ‰«ææ•´ä¸ªè€å¹´ä»£ï¼Œè€Œæ˜¯==åœ¨å¡è¡¨ä¸­å¯»æ‰¾è„å¡ï¼Œå¹¶å°†è„å¡ä¸­çš„å¯¹è±¡åŠ å…¥åˆ° Minor GC çš„ GC Roots é‡Œ==ã€‚å½“å®Œæˆæ‰€æœ‰è„å¡çš„æ‰«æä¹‹åï¼ŒJava è™šæ‹Ÿæœºä¾¿ä¼šå°†æ‰€æœ‰è„å¡çš„æ ‡è¯†ä½æ¸…é›¶ã€‚ç”±äº Minor GC ä¼´éšç€å­˜æ´»å¯¹è±¡çš„å¤åˆ¶ï¼Œè€Œå¤åˆ¶éœ€è¦æ›´æ–°æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚å› æ­¤ï¼Œåœ¨æ›´æ–°å¼•ç”¨çš„åŒæ—¶ï¼Œæˆ‘ä»¬åˆä¼šè®¾ç½®å¼•ç”¨æ‰€åœ¨çš„å¡çš„æ ‡è¯†ä½ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿è„å¡ä¸­å¿…å®šåŒ…å«æŒ‡å‘æ–°ç”Ÿä»£å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<h2 id="å¯¹äºè€å¹´ä»£"><a href="#å¯¹äºè€å¹´ä»£" class="headerlink" title="å¯¹äºè€å¹´ä»£"></a>å¯¹äºè€å¹´ä»£</h2><p>çŒœæµ‹å¤§éƒ¨åˆ†çš„åƒåœ¾å·²ç»åœ¨æ–°ç”Ÿä»£ä¸­è¢«å›æ”¶äº†ï¼Œè€Œåœ¨è€å¹´ä»£ä¸­çš„å¯¹è±¡æœ‰å¤§æ¦‚ç‡ä¼šç»§ç»­å­˜æ´»ã€‚å½“çœŸæ­£è§¦å‘é’ˆå¯¹è€å¹´ä»£çš„å›æ”¶æ—¶ï¼Œåˆ™ä»£è¡¨è¿™ä¸ªå‡è®¾å‡ºé”™äº†ï¼Œæˆ–è€…å †çš„ç©ºé—´å·²ç»è€—å°½äº†ã€‚</p>
<p><strong>è¿™æ—¶å€™</strong>ï¼ŒJava è™šæ‹Ÿæœºå¾€å¾€éœ€è¦åšä¸€æ¬¡å…¨å †æ‰«æï¼Œè€—æ—¶ä¹Ÿå°†ä¸è®¡æˆæœ¬ã€‚ï¼ˆå½“ç„¶ï¼Œç°ä»£çš„åƒåœ¾å›æ”¶å™¨éƒ½åœ¨å¹¶å‘æ”¶é›†çš„é“è·¯ä¸Šå‘å±•ï¼Œæ¥é¿å…è¿™ç§å…¨å †æ‰«æçš„æƒ…å†µã€‚ï¼‰</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/05/%E5%85%B3%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" data-id="ckpe515zy0005zu0tblvl2psq" data-title="å…³äºè™šæ‹Ÿæœºä¸­çš„åƒåœ¾å›æ”¶" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">Javaè™šæ‹Ÿæœº</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Redis/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/04/Redis/index/" class="article-date">
  <time class="dt-published" datetime="2021-05-04T04:57:40.000Z" itemprop="datePublished">2021-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">JavaåŸºç¡€</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/04/Redis/index/">HashMap</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>hashMapçš„æ’å…¥</p>
<p>1ã€åˆ¤ç©ºï¼Œä¸ºç©ºåˆå§‹åŒ–</p>
<p>2ã€ä¸ä¸ºç©ºï¼Œè®¡ç®—keyçš„hashå€¼ï¼Œå­˜æ”¾æ•°ç»„å¯¹åº”ä¸‹æ ‡indexï¼ˆï¼ˆn-1ï¼‰%hashï¼‰</p>
<p>3ã€<strong>æŸ¥çœ‹table[index]æ˜¯å¦å­˜åœ¨æ•°æ®</strong>ï¼Œæ²¡æœ‰æ•°æ®å°±æ„é€ ä¸€ä¸ªNodeèŠ‚ç‚¹æ”¾åœ¨table[index]</p>
<p>4ã€å­˜åœ¨ï¼Œè¯´æ˜å‘ç”Ÿäº†<strong>hashå†²çª</strong>ï¼Œç»§ç»­åˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™æ›´æ–°value</p>
<p>5ã€<strong>å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ¤æ–­æ˜¯å¦æ ‘å½¢èŠ‚ç‚¹</strong>ï¼Œå¦‚æœæ˜¯æ ‘å½¢èŠ‚ç‚¹ï¼Œåˆ›å»ºæ ‘å½¢æ¥å¾…ä½ æ’å…¥çº¢é»‘æ ‘ä¸­</p>
<p>6ã€å¦‚æœä¸æ˜¯æ ‘å½¢èŠ‚ç‚¹ï¼Œåˆ›å»ºæ™®é€šNodeåŠ å…¥é“¾è¡¨ä¸­ï¼›å¹¶åˆ¤æ–­ï¼›<strong>é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8</strong>ï¼Œå¤§äºçš„è¯é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘</p>
<p>7ã€<strong>æ’å…¥å®Œæˆååˆ¤æ–­å½“å‰èŠ‚ç‚¹æ•°æ˜¯å¦å¤§äºé˜ˆå€¼</strong>ï¼Œå¦‚æœå¤§äºå¼€å§‹æ‰©å®¹ä¸ºåŸæ•°ç»„çš„äºŒå€</p>
<p>hashMapåˆå§‹åŒ–</p>
<p>ä¸€èˆ¬å¦‚æœ<code>new HashMap()</code> ä¸ä¼ å€¼ï¼Œé»˜è®¤å¤§å°æ˜¯ 16ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ï¼Œ å¦‚æœè‡ªå·±<strong>ä¼ å…¥åˆå§‹å¤§å° kï¼Œåˆå§‹åŒ–å¤§å°ä¸ºå¤§äº k çš„ 2 çš„æ•´æ•°æ¬¡æ–¹</strong>ï¼Œä¾‹å¦‚å¦‚æœä¼  10ï¼Œå¤§å°ä¸º 16ï¼ˆä¼ å…¥k=50ï¼Œå¤§å°ä¸º2çš„6æ¬¡æ–¹ï¼‰ã€‚</p>
<p>ç®—æ³•å°±æ˜¯è®©åˆå§‹äºŒè¿›åˆ¶åˆ†åˆ«å³ç§» 1ï¼Œ2ï¼Œ4ï¼Œ8ï¼Œ16ä½ï¼Œä¸è‡ªå·±å¼‚æˆ–ï¼ŒæŠŠé«˜ä½ç¬¬ä¸€ä¸ªä¸º 1 çš„æ•°é€šè¿‡ä¸æ–­å³ç§»ï¼ŒæŠŠé«˜ä½ä¸º 1 çš„åé¢å…¨å˜ä¸º 1ï¼Œ111111 + 1 = 1000000  = 2çš„6æ¬¡æ–¹ï¼ˆç¬¦åˆå¤§äº 50 å¹¶ä¸”æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">static final int tableSizeFor(int cap) &#123; </span><br><span class="line">int n = cap - 1;  </span><br><span class="line">n |= n &gt;&gt;&gt; 1; </span><br><span class="line">n |= n &gt;&gt;&gt; 2; </span><br><span class="line">n |= n &gt;&gt;&gt; 4; </span><br><span class="line">n |= n &gt;&gt;&gt; 8;  </span><br><span class="line">n |= n &gt;&gt;&gt; 16; </span><br><span class="line">return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ?    MAXIMUM_CAPACITY : n + 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>hashå‡½æ•°çš„è®¾è®¡</p>
<p> hash å‡½æ•°æ˜¯å…ˆæ‹¿åˆ°<strong>é€šè¿‡ key  çš„ hashcodeï¼Œæ˜¯ 32 ä½çš„ int å€¼ï¼Œç„¶åè®© hashcode çš„é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚</strong></p>
<p>è¿™ä¸ªä¹Ÿå«æ‰°åŠ¨å‡½æ•°ï¼Œè¿™ä¹ˆè®¾è®¡æœ‰äºŒç‚¹åŸå› ï¼š</p>
<p>1ã€ä¸€å®šè¦å°½å¯èƒ½é™ä½ hash ç¢°æ’ï¼Œè¶Šåˆ†æ•£è¶Šå¥½ï¼›</p>
<p>key.hashCode() å‡½æ•°è°ƒç”¨çš„æ˜¯ key é”®å€¼ç±»å‹è‡ªå¸¦çš„å“ˆå¸Œå‡½æ•°ï¼Œè¿”å› int å‹æ•£åˆ—å€¼ã€‚int å€¼èŒƒå›´ä¸º <strong>-2147483648~2147483647</strong>ï¼Œå‰ååŠ èµ·æ¥å¤§æ¦‚ 40 äº¿çš„æ˜ å°„ç©ºé—´ã€‚åªè¦å“ˆå¸Œå‡½æ•°æ˜ å°„å¾—æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œä¸€èˆ¬åº”ç”¨æ˜¯å¾ˆéš¾å‡ºç°ç¢°æ’çš„ã€‚</p>
<p>è¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†ä¸ºä»€ä¹ˆ HashMap çš„æ•°ç»„é•¿åº¦è¦å– 2 çš„æ•´æ•°å¹‚ã€‚å› ä¸ºè¿™æ ·ï¼ˆæ•°ç»„é•¿åº¦ -1ï¼‰æ­£å¥½ç›¸å½“äºä¸€ä¸ªâ€œä½ä½æ©ç â€ã€‚â€œä¸â€æ“ä½œçš„ç»“æœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½ä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—®ã€‚ä»¥åˆå§‹é•¿åº¦ 16 ä¸ºä¾‹ï¼Œ16-1=15ã€‚2 è¿›åˆ¶è¡¨ç¤ºæ˜¯ 00000000 00000000 00001111ã€‚å’ŒæŸæ•£åˆ—å€¼åšâ€œä¸â€æ“ä½œå¦‚ä¸‹ï¼Œç»“æœå°±æ˜¯æˆªå–äº†æœ€ä½çš„å››ä½å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10100101 11000100 00100101</span><br><span class="line">&amp; 00000000 00000000 00001111</span><br><span class="line">----------------------------------  </span><br><span class="line">00000000 00000000 00000101    //é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™æœ«å››ä½</span><br></pre></td></tr></table></figure>

<p>ä½†è¿™æ—¶å€™é—®é¢˜å°±æ¥äº†ï¼Œè¿™æ ·å°±ç®—æˆ‘çš„æ•£åˆ—å€¼åˆ†å¸ƒå†æ¾æ•£ï¼Œè¦æ˜¯åªå–æœ€åå‡ ä½çš„è¯ï¼Œç¢°æ’ä¹Ÿä¼šå¾ˆä¸¥é‡ã€‚æ›´è¦å‘½çš„æ˜¯å¦‚æœæ•£åˆ—æœ¬èº«åšå¾—ä¸å¥½ï¼Œåˆ†å¸ƒä¸Šæˆç­‰å·®æ•°åˆ—çš„æ¼æ´ï¼Œå¦‚æœæ­£å¥½è®©æœ€åå‡ ä¸ªä½ä½å‘ˆç°è§„å¾‹æ€§é‡å¤ï¼Œå°±æ— æ¯”è›‹ç–¼ã€‚</p>
<p>å³ä½ç§» 16 ä½ï¼Œæ­£å¥½æ˜¯ 32bit çš„ä¸€åŠï¼Œè‡ªå·±çš„é«˜åŠåŒºå’Œä½åŠåŒºåšå¼‚æˆ–ï¼Œå°±æ˜¯ä¸ºäº†æ··åˆåŸå§‹å“ˆå¸Œç çš„é«˜ä½å’Œä½ä½ï¼Œä»¥æ­¤æ¥åŠ å¤§ä½ä½çš„éšæœºæ€§ã€‚<strong>è€Œä¸”æ··åˆåçš„ä½ä½æºæ‚äº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾ï¼Œè¿™æ ·é«˜ä½çš„ä¿¡æ¯ä¹Ÿè¢«å˜ç›¸ä¿ç•™ä¸‹æ¥ã€‚</strong></p>
<p>2ã€ç®—æ³•ä¸€å®šè¦å°½å¯èƒ½é«˜æ•ˆï¼Œå› ä¸ºè¿™æ˜¯é«˜é¢‘æ“ä½œ, å› æ­¤é‡‡ç”¨ä½è¿ç®—ã€‚</p>
<p>æºç ä¸­æ¨¡è¿ç®—å°±æ˜¯æŠŠæ•£åˆ—å€¼å’Œæ•°ç»„é•¿åº¦ -1 åšä¸€ä¸ªâ€ä¸â€æ“ä½œï¼Œä½è¿ç®—æ¯” % è¿ç®—è¦å¿«ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bucketIndex = indexFor(hash, table.length);</span><br><span class="line">static int indexFor(int h, int length) &#123;     </span><br><span class="line">return h &amp; (length-1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>hashmap 1.8çš„ä¼˜åŒ–</p>
<p>1ã€<strong>æ•°ç»„+é“¾è¡¨æ”¹æˆäº†æ•°ç»„+é“¾è¡¨æˆ–çº¢é»‘æ ‘</strong>ï¼›</p>
<p>é˜²æ­¢å‘ç”Ÿ hash å†²çªï¼Œé“¾è¡¨é•¿åº¦è¿‡é•¿ï¼Œå°†æ—¶é—´å¤æ‚åº¦ç”±<code>O(n)</code>é™ä¸º<code>O(logn)</code>ï¼›</p>
<p>2ã€é“¾è¡¨çš„æ’å…¥æ–¹å¼ä»å¤´æ’æ³•æ”¹æˆäº†å°¾æ’æ³•ï¼Œç®€å•è¯´å°±æ˜¯æ’å…¥æ—¶ï¼Œå¦‚æœæ•°ç»„ä½ç½®ä¸Šå·²ç»æœ‰å…ƒç´ ï¼Œ1.7 å°†æ–°å…ƒç´ æ”¾åˆ°æ•°ç»„ä¸­ï¼ŒåŸå§‹èŠ‚ç‚¹ä½œä¸ºæ–°èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ï¼Œ<strong>1.8 éå†é“¾è¡¨ï¼Œå°†å…ƒç´ æ”¾ç½®åˆ°é“¾è¡¨çš„æœ€åï¼›</strong></p>
<p>â€‹       A çº¿ç¨‹åœ¨æ’å…¥èŠ‚ç‚¹ Bï¼ŒB çº¿ç¨‹ä¹Ÿåœ¨æ’å…¥ï¼Œé‡åˆ°å®¹é‡ä¸å¤Ÿå¼€å§‹æ‰©å®¹ï¼Œé‡æ–° hashï¼Œæ”¾ç½®å…ƒç´ ï¼Œé‡‡ç”¨å¤´æ’æ³•ï¼Œåéå†åˆ°çš„ B èŠ‚ç‚¹æ”¾å…¥äº†å¤´éƒ¨ï¼Œè¿™æ ·å½¢æˆäº†ç¯</p>
<p><img src="https://i.loli.net/2021/05/31/Z2y7aOv4GIJBXMH.png" alt="ä¸Šä¼ 1.png"></p>
<p>3ã€æ‰©å®¹çš„æ—¶å€™ 1.7 éœ€è¦å¯¹åŸæ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œé‡æ–° hash å®šä½åœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼Œ<strong>1.8 é‡‡ç”¨æ›´ç®€å•çš„åˆ¤æ–­é€»è¾‘ï¼Œä½ç½®ä¸å˜æˆ–ç´¢å¼•+æ—§å®¹é‡å¤§å°ï¼›</strong></p>
<p>  è¿™æ˜¯ç”±äºæ‰©å®¹æ˜¯æ‰©å¤§ä¸ºåŸæ•°ç»„å¤§å°çš„ 2 å€ï¼Œç”¨äºè®¡ç®—æ•°ç»„ä½ç½®çš„æ©ç ä»…ä»…åª   </p>
<p>  æ˜¯é«˜ä½å¤šäº†ä¸€ä¸ª 1ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>  æ‰©å®¹å‰é•¿åº¦ä¸º 16ï¼Œç”¨äºè®¡ç®— <strong>(n-1) &amp; hash</strong> çš„äºŒè¿›åˆ¶ n - 1 ä¸º 0000 1111ï¼Œ </p>
<p>   <strong>æ‰©å®¹åä¸º 32 åçš„äºŒè¿›åˆ¶å°±é«˜ä½å¤šäº† 1ï¼Œ============&gt;ä¸º 0001 1111ã€‚</strong></p>
<p><strong>å› ä¸ºæ˜¯ &amp; è¿ç®—</strong>ï¼Œ<strong>1 å’Œä»»ä½•æ•° &amp; éƒ½æ˜¯å®ƒæœ¬èº«</strong>ï¼Œé‚£å°±åˆ†äºŒç§æƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼šåŸæ•°æ® hashcode é«˜ä½ç¬¬ 4 ä½ä¸º 0 å’Œé«˜ä½ä¸º 1 çš„æƒ…å†µï¼›</p>
<p>ç¬¬å››ä½é«˜ä½ä¸º 0ï¼Œé‡æ–° hash æ•°å€¼ä¸å˜ï¼Œç¬¬å››ä½ä¸º 1ï¼Œé‡æ–° hash æ•°å€¼æ¯”åŸæ¥å¤§ 16ï¼ˆæ—§æ•°ç»„çš„å®¹é‡ï¼‰ã€‚</p>
<p><img src="https://i.loli.net/2021/05/31/GSOu5roHPDx6zp9.png" alt="ä¸Šä¼ 2.png"></p>
<p>4ã€åœ¨æ’å…¥æ—¶ï¼Œ1.7 å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå†æ’å…¥ï¼Œ<strong>1.8 å…ˆè¿›è¡Œæ’å…¥ï¼Œæ’å…¥å®Œæˆå†åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</strong></p>
<p><strong>HashMap æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</strong></p>
<p>ä¸æ˜¯ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œ1.7 ä¼šäº§ç”Ÿæ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€æ•°æ®è¦†ç›–çš„é—®é¢˜ï¼Œ1.8 ä¸­ä¼šæœ‰<strong>æ•°æ®è¦†ç›–ã€å¤šçº¿ç¨‹åŒæ—¶æ‰©å®¹</strong>çš„é—®é¢˜ã€‚</p>
<p><strong>é‚£ä½ å¹³å¸¸æ€ä¹ˆè§£å†³è¿™ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼Ÿ</strong></p>
<p>Java ä¸­æœ‰ <strong>HashTableã€Collections.synchronizedMapã€ä»¥åŠ ConcurrentHashMap</strong> å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨çš„ Mapã€‚</p>
<ol>
<li>HashTable æ˜¯ç›´æ¥åœ¨æ“ä½œæ–¹æ³•ä¸ŠåŠ  synchronized å…³é”®å­—ï¼Œé”ä½æ•´ä¸ªæ•°ç»„ï¼Œç²’åº¦æ¯”è¾ƒå¤§ï¼›</li>
<li>Collections.synchronizedMap æ˜¯ä½¿ç”¨ Collections é›†åˆå·¥å…·çš„å†…éƒ¨ç±»ï¼Œé€šè¿‡ä¼ å…¥ Map å°è£…å‡ºä¸€ä¸ª SynchronizedMap å¯¹è±¡ï¼Œå†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡é”ï¼Œæ–¹æ³•å†…é€šè¿‡å¯¹è±¡é”å®ç°ï¼›</li>
<li>ConcurrentHashMap ä½¿ç”¨åˆ†æ®µé”ï¼Œé™ä½äº†é”ç²’åº¦ï¼Œè®©å¹¶å‘åº¦å¤§å¤§æé«˜ã€‚</li>
</ol>
<p> <strong>ConcurrentHashMap çš„åˆ†æ®µé”çš„å®ç°åŸç†å—ï¼Ÿ</strong></p>
<p>ConcurrentHashMap </p>
<p>1ã€æˆå‘˜å˜é‡ä½¿ç”¨ volatile ä¿®é¥°ï¼Œå…é™¤äº†æŒ‡ä»¤é‡æ’åºï¼ŒåŒæ—¶ä¿è¯å†…å­˜å¯è§æ€§</p>
<p>2ã€å¦å¤–ä½¿ç”¨ CAS æ“ä½œå’Œ synchronized ç»“åˆå®ç°èµ‹å€¼æ“ä½œï¼Œå¤šçº¿ç¨‹æ“ä½œåªä¼šé”ä½å½“å‰æ“ä½œç´¢å¼•çš„èŠ‚ç‚¹ã€‚</p>
<p><strong>ä½ å‰é¢æåˆ°é“¾è¡¨è½¬çº¢é»‘æ ‘æ˜¯é“¾è¡¨é•¿åº¦è¾¾åˆ°é˜ˆå€¼ï¼Œè¿™ä¸ªé˜ˆå€¼æ˜¯å¤šå°‘ï¼Ÿ</strong> </p>
<p>é˜ˆå€¼æ˜¯ 8ï¼Œçº¢é»‘æ ‘è½¬é“¾è¡¨é˜ˆå€¼ä¸º 6ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯ 8ï¼Œä¸æ˜¯ 16ï¼Œ32 ç”šè‡³æ˜¯ 7 ï¼Ÿåˆä¸ºä»€ä¹ˆçº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜ˆå€¼æ˜¯ 6ï¼Œä¸æ˜¯ 8 äº†å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸ºç»è¿‡è®¡ç®—ï¼Œåœ¨ hash å‡½æ•°è®¾è®¡åˆç†çš„æƒ…å†µä¸‹ï¼Œ<strong>å‘ç”Ÿ hash ç¢°æ’ 8 æ¬¡çš„å‡ ç‡ä¸ºç™¾ä¸‡åˆ†ä¹‹ 6</strong>ï¼Œæ¦‚ç‡è¯´è¯ã€‚ã€‚å› ä¸º 8 å¤Ÿç”¨äº†ï¼Œè‡³äºä¸ºä»€ä¹ˆè½¬å›æ¥æ˜¯ 6ï¼Œ<strong>å› ä¸ºå¦‚æœ hash ç¢°æ’æ¬¡æ•°åœ¨ 8 é™„è¿‘å¾˜å¾Šï¼Œä¼šä¸€ç›´å‘ç”Ÿé“¾è¡¨å’Œçº¢é»‘æ ‘çš„è½¬åŒ–ï¼Œä¸ºäº†é¢„é˜²è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</strong></p>
<p>1ã€ HashMap å†…éƒ¨èŠ‚ç‚¹æ˜¯æœ‰åºçš„å—ï¼Ÿ</p>
<p><strong>æ˜¯æ— åºçš„ï¼Œæ ¹æ® hash å€¼éšæœºæ’å…¥ã€‚</strong></p>
<p>2ã€é‚£æœ‰æ²¡æœ‰æœ‰åºçš„ Mapï¼Ÿ</p>
<p><strong>LinkedHashMap å’Œ TreeMapã€‚</strong></p>
<p>3ã€ è·Ÿæˆ‘è®²è®² LinkedHashMap æ€ä¹ˆå®ç°æœ‰åºçš„ï¼Ÿ</p>
<p><strong>LinkedHashMap å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå•é“¾è¡¨</strong>ï¼Œæœ‰ å¤´å°¾èŠ‚ç‚¹ ï¼Œ</p>
<p>åŒæ—¶ LinkedHashMap èŠ‚ç‚¹ Entry å†…éƒ¨é™¤äº†ç»§æ‰¿ HashMap çš„ Node å±æ€§ï¼Œ</p>
<p>è¿˜<strong>æœ‰ before  å’Œ after ç”¨äºæ ‡è¯†å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ã€‚</strong>å¯ä»¥å®ç°æŒ‰æ’å…¥çš„é¡ºåºæˆ–è®¿é—®é¡ºåºæ’åºã€‚</p>
<p>4ã€è·Ÿæˆ‘è®²è®² TreeMap æ€ä¹ˆå®ç°æœ‰åºçš„ï¼Ÿ</p>
<p>TreeMap æ˜¯æŒ‰ç…§ Key çš„è‡ªç„¶é¡ºåºæˆ–è€… Comprator çš„é¡ºåºè¿›è¡Œæ’åºï¼Œ<strong>å†…éƒ¨æ˜¯é€šè¿‡çº¢é»‘æ ‘æ¥å®ç°</strong>ã€‚æ‰€ä»¥è¦ä¹ˆ key æ‰€å±çš„ç±»å®ç° Comparable æ¥å£ï¼Œæˆ–è€…è‡ªå®šä¹‰ä¸€ä¸ªå®ç°äº† Comparator æ¥å£çš„æ¯”è¾ƒå™¨ï¼Œä¼ ç»™ TreeMap ç”¨æˆ· key çš„æ¯”è¾ƒã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/04/Redis/index/" data-id="ckpe51600000azu0thodw5nla" data-title="HashMap" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hashmap/" rel="tag">hashmap</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-MYSQLäº‹åŠ¡å°è®°" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/01/MYSQL%E4%BA%8B%E5%8A%A1%E5%B0%8F%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2021-05-01T03:29:09.000Z" itemprop="datePublished">2021-05-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/01/MYSQL%E4%BA%8B%E5%8A%A1%E5%B0%8F%E8%AE%B0/">MYSQLäº‹åŠ¡å°è®°</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="äº‹åŠ¡éš”ç¦»"><a href="#äº‹åŠ¡éš”ç¦»" class="headerlink" title="äº‹åŠ¡éš”ç¦»"></a>äº‹åŠ¡éš”ç¦»</h1><p><strong>äº‹åŠ¡æ¦‚å¿µ</strong>ï¼šæåˆ°äº‹åŠ¡ï¼Œä½ è‚¯å®šä¸é™Œç”Ÿï¼Œå’Œæ•°æ®åº“æ‰“äº¤é“çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼šç”¨åˆ°äº‹åŠ¡ã€‚æœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯è½¬è´¦ï¼Œä½ è¦ç»™æœ‹å‹å°ç‹è½¬ 100 å—é’±ï¼Œè€Œæ­¤æ—¶ä½ çš„é“¶è¡Œå¡åªæœ‰ 100 å—é’±ã€‚<br>è½¬è´¦è¿‡ç¨‹å…·ä½“åˆ°ç¨‹åºé‡Œä¼šæœ‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ¯”å¦‚æŸ¥è¯¢ä½™é¢ã€åšåŠ å‡æ³•ã€æ›´æ–°ä½™é¢ç­‰ï¼Œè¿™äº›æ“ä½œå¿…é¡»ä¿è¯æ˜¯ä¸€ä½“çš„ï¼Œä¸ç„¶ç­‰ç¨‹åºæŸ¥å®Œä¹‹åï¼Œè¿˜æ²¡åšå‡æ³•ä¹‹å‰ï¼Œä½ è¿™ 100 å—é’±ï¼Œå®Œå…¨å¯ä»¥å€Ÿç€è¿™ä¸ªæ—¶é—´å·®å†æŸ¥ä¸€æ¬¡ï¼Œç„¶åå†ç»™å¦å¤–ä¸€ä¸ªæœ‹å‹è½¬è´¦ï¼Œå¦‚æœé“¶è¡Œè¿™ä¹ˆæ•´ï¼Œä¸å°±ä¹±äº†ä¹ˆï¼Ÿè¿™æ—¶å°±è¦ç”¨åˆ°â€œäº‹åŠ¡â€è¿™ä¸ªæ¦‚å¿µäº†ã€‚ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼‰</p>
<p><strong>äº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“å±‚å®ç°çš„</strong>ï¼šMySQL æ˜¯ä¸€ä¸ªæ”¯æŒå¤šå¼•æ“çš„ç³»ç»Ÿï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒäº‹åŠ¡ã€‚æ¯”å¦‚ MySQL åŸç”Ÿçš„ MyISAM å¼•æ“å°±ä¸æ”¯æŒäº‹åŠ¡ï¼Œè¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB å–ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚</p>
<h2 id="éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«"></a>éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«</h2><p>ACIDï¼ˆAtomicityåŸå­æ€§ã€Consistencyä¸€è‡´æ€§ã€Isolationéš”ç¦»æ€§ã€DurabilityæŒä¹…æ€§ï¼‰</p>
<h3 id="Iï¼ˆIsolationéš”ç¦»æ€§ï¼‰"><a href="#Iï¼ˆIsolationéš”ç¦»æ€§ï¼‰" class="headerlink" title="Iï¼ˆIsolationéš”ç¦»æ€§ï¼‰"></a>Iï¼ˆIsolation<strong>éš”ç¦»æ€§</strong>ï¼‰</h3><p>å½“æ•°æ®åº“ä¸Šæœ‰å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°è„è¯»ï¼ˆdirty readï¼‰ã€ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰ã€å¹»è¯»ï¼ˆphantom readï¼‰</p>
<h4 id="è„è¯»"><a href="#è„è¯»" class="headerlink" title="è„è¯»"></a>è„è¯»</h4><p>è¯»åˆ°å…¶ä»–äº‹åŠ¡<strong>æœªæäº¤çš„æ•°æ®</strong></p>
<h4 id="ä¸å¯é‡å¤è¯»"><a href="#ä¸å¯é‡å¤è¯»" class="headerlink" title="ä¸å¯é‡å¤è¯»"></a>ä¸å¯é‡å¤è¯»</h4><p>å‰åè¯»å–çš„<strong>è®°å½•å†…å®¹</strong>ä¸ä¸€è‡´</p>
<h4 id="å¹»è¯»"><a href="#å¹»è¯»" class="headerlink" title="å¹»è¯»"></a>å¹»è¯»</h4><p>å‰åè¯»å–çš„<strong>è®°å½•æ•°é‡</strong>ä¸ä¸€è‡´</p>
<h3 id="â€“-gt-éš”ç¦»çº§åˆ«"><a href="#â€“-gt-éš”ç¦»çº§åˆ«" class="headerlink" title="â€“&gt;éš”ç¦»çº§åˆ«"></a>â€“&gt;éš”ç¦»çº§åˆ«</h3><ul>
<li><p>éš”ç¦»è¶Šä¸¥å®ï¼Œæ•ˆç‡è¶Šä½</p>
</li>
<li><p>sqlæ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼š</p>
<p>1ã€è¯»æœªæäº¤   </p>
<p>ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°</p>
<p>2ã€è¯»æäº¤  </p>
<p>ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°</p>
<p>3ã€å¯é‡å¤è¯» ï¼ˆåˆ«äººæ”¹æ•°æ®çš„äº‹åŠ¡å·²ç»æäº¤ï¼Œæˆ‘åœ¨æˆ‘çš„äº‹åŠ¡ä¸­ä¹Ÿä¸å»è¯»ï¼‰</p>
<p>ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ˆåœ¨å®ç°ä¸Šï¼Œæ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘çš„é€»è¾‘ç»“æœä¸ºå‡†ã€‚åœ¨â€œå¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚åœ¨â€œè¯»æäº¤â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„ï¼‰ã€‚å½“ç„¶åœ¨å¯é‡è¯»è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„</p>
<p>åœºæ™¯ï¼šå‡è®¾ä½ åœ¨ç®¡ç†ä¸€ä¸ªä¸ªäººé“¶è¡Œè´¦æˆ·è¡¨ã€‚ä¸€ä¸ªè¡¨å­˜äº†è´¦æˆ·ä½™é¢ï¼Œä¸€ä¸ªè¡¨å­˜äº†è´¦å•æ˜ç»†ã€‚åˆ°äº†æœˆåº•ä½ è¦åšæ•°æ®æ ¡å¯¹ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­ä¸Šä¸ªæœˆçš„ä½™é¢å’Œå½“å‰ä½™é¢çš„å·®é¢ï¼Œæ˜¯å¦ä¸æœ¬æœˆçš„è´¦å•æ˜ç»†ä¸€è‡´ã€‚ä½ ä¸€å®šå¸Œæœ›åœ¨æ ¡å¯¹è¿‡ç¨‹ä¸­ï¼Œå³ä½¿æœ‰ç”¨æˆ·å‘ç”Ÿäº†ä¸€ç¬”æ–°çš„äº¤æ˜“ï¼Œä¹Ÿä¸å½±å“ä½ çš„æ ¡å¯¹ç»“æœï¼ˆè¿™æ—¶å€™ä½¿ç”¨â€œå¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«å°±å¾ˆæ–¹ä¾¿ã€‚äº‹åŠ¡å¯åŠ¨æ—¶çš„è§†å›¾å¯ä»¥è®¤ä¸ºæ˜¯é™æ€çš„ï¼Œä¸å—å…¶ä»–äº‹åŠ¡æ›´æ–°çš„å½±å“ã€‚ï¼‰</p>
<p>4ã€ä¸²è¡ŒåŒ–</p>
</li>
</ul>
<p>â€‹       é¡¾åæ€ä¹‰ï¼Œå¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œå†™ä¼šåŠ å†™é”ï¼Œè¯»ä¼šåŠ è¯»é”ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰é’±ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œ</p>
<h3 id="â€“-gt-äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°"><a href="#â€“-gt-äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°" class="headerlink" title="â€“&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°"></a>â€“&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«çš„å®ç°</h3><p>åœ¨ MySQL ä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚<br>å‡è®¾ä¸€ä¸ªå€¼ä» 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚</p>
<p><img src="https://i.loli.net/2021/05/31/FDNJ5qOeC8ZpjMo.png" alt="image-20210419105450131.png"></p>
<p>å½“å‰å€¼æ˜¯ 4ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾ Aã€Bã€C é‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯ 1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚<strong>å¯¹äº read-view Aï¼Œè¦å¾—åˆ° 1ï¼Œå°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œå¾—åˆ°ã€‚</strong></p>
<p>åŒæ—¶ä½ ä¼šå‘ç°ï¼Œ<strong>å³ä½¿ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å°† 4 æ”¹æˆ 5ï¼Œè¿™ä¸ªäº‹åŠ¡è·Ÿ read-view Aã€Bã€C å¯¹åº”çš„äº‹åŠ¡æ˜¯ä¸ä¼šå†²çªçš„ã€‚</strong></p>
<p>ä½ ä¸€å®šä¼šé—®ï¼Œå›æ»šæ—¥å¿—æ€»ä¸èƒ½ä¸€ç›´ä¿ç•™å§ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼ˆ<strong>å½“æ²¡æœ‰æ¯”å›æ»šæ—¥å¿—æ›´æ—©çš„è¯»è§†å›¾ï¼ˆè¯»è§†å›¾åœ¨äº‹åŠ¡å¼€å¯æ—¶åˆ›å»ºï¼‰çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®ä¸ä¼šå†æœ‰è°é©±ä½¿å®ƒå›æ»šäº†ï¼Œè¿™ä¸ªå›æ»šæ—¥å¿—ä¹Ÿå°±å¤±å»äº†ç”¨æ­¦ä¹‹åœ°ï¼Œå¯ä»¥åˆ é™¤äº†</strong>ï¼‰</p>
<p>ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢ï¼Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„ read-view çš„æ—¶å€™ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ï¼Ÿ</h3><p>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/05/01/MYSQL%E4%BA%8B%E5%8A%A1%E5%B0%8F%E8%AE%B0/" data-id="ckpe515zu0001zu0tc7b396bb" data-title="MYSQLäº‹åŠ¡å°è®°" class="article-share-link">åˆ†äº«</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">JavaåŸºç¡€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">å¤šçº¿ç¨‹</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">æ¶ˆæ¯é˜Ÿåˆ—</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">Javaè™šæ‹Ÿæœº</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hashmap/" rel="tag">hashmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitmq/" rel="tag">rabbitmq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 10px;">Javaè™šæ‹Ÿæœº</a> <a href="/tags/hashmap/" style="font-size: 10px;">hashmap</a> <a href="/tags/rabbitmq/" style="font-size: 10px;">rabbitmq</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">å¤šçº¿ç¨‹</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">äº”æœˆ 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/05/12/mq%E5%B0%8F%E8%AE%B0/">mqå°è®°</a>
          </li>
        
          <li>
            <a href="/2021/05/10/ThreadLocal%E5%B0%8F%E7%BB%93/">ThreadLocalå°ç»“</a>
          </li>
        
          <li>
            <a href="/2021/05/07/AOP%E5%BA%94%E7%94%A8/">AOPåº”ç”¨</a>
          </li>
        
          <li>
            <a href="/2021/05/05/%E5%85%B3%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">å…³äºè™šæ‹Ÿæœºä¸­çš„åƒåœ¾å›æ”¶</a>
          </li>
        
          <li>
            <a href="/2021/05/04/Redis/index/">HashMap</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 PP<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/" class="mobile-nav-link">ä¸»é¡µ</a>
  
    <a href="/archives" class="mobile-nav-link">ä¸“æ </a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>